+++
title = "Mongodb写操作事务"
date = "2020-02-11T10:04:46+08:00"
description = "Mongodb事务相关的写操作事务属性"
tags = ["数据库"]
+++

## writeConcern

### w: value

给了这个参数，就决定了一个写操作落到多少个节点上才能成功。取值为：

- 0：发起写操作，不关心是否成功
- 1～集群的节点数：写操作需要到指定节点数才能成功
- majority：写操作需要被复制到大多数节点才算成功
Tips：发起写操作的程序将阻塞到写操作到达指定的节点数为止

### j: boolean

该值定义如何才算成功。控制该操作是否很重要，如果到达内存即可得话设置false。

- true：写操作落到journal文件才算成功
- false：写操作到达内存就算成功

### wtimeout: number

在规定时间内完成写操作，如果不在设置的时间内完成就抛错

## 注意

1. 不要设置`writeConcern`等于总节点数，因为其中一个节点挂了，那么所有写操作就都失败。通常只会设置`majority`，因为这是等待写入延迟时间最短的选择。
2. `writeConcern`虽然会增加写操作延迟，但不会增加集群压力。只是让写操作等待复制后再返回而已。
3. 对重要数据应用`{w: “majority"}`，普通数据可以应用`{w: 1}`确保性能
